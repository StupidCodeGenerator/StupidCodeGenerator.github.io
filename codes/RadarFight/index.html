<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">    
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <title>CollisionTest</title>
        <style>
            canvas {
                display: block;
                position: absolute;
                margin: auto;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }
        </style>
    </head>
    <body>
        <script src="fighter.js"></script>
        <script src="Utils.js"></script>
        <script src="buttonScan.js"></script>
        <script>
            // ----- Create Canvas ------
            canvas = document.createElement("canvas");
        
            width = window.innerWidth;
            height = window.innerHeight;

            if (width >= 500) {
                width  = 320;
                height = 480;
                canvas.style.border = "1px solid #000";
            }
    
            canvas.width = width;
            canvas.height = height;

            if (!(!!canvas.getContext && canvas.getContext("2d"))) {
                    alert("Your browser doesn't support HTML5, please update to latest version");
            }
            context = canvas.getContext('2d');
            document.body.appendChild(canvas);

            var loop = function() {
                update();
                render();
                window.requestAnimationFrame(loop, canvas);
            }
            window.requestAnimationFrame(loop, canvas);

            // ----- Start Game Logic -----    

            var message;

            var fighter = new Fighter(200, 300, 0);
            var scanButton = new ScanButton(5,canvas.height - 45);

            function update(){
                fighter.update();
            }

            function render(){
                context.save();
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = 'black';
                context.rect(0, 0, canvas.width, canvas.height);
                context.fill();
                context.stroke();
                context.restore();
                fighter.draw();
                scanButton.draw();
                writeMessage(canvas, message, 10, 10);
                //writeMessage(canvas, "angle" + fighter.alpha, 10, 30);
            }

            function DrawSmallRect(x, y, w, h){
                context.beginPath();
                context.rect(x - w/2, y - h/2, w, h);
                context.lineWidth = 3;
                context.strokeStyle = 'white';
                context.stroke();
            }

            function writeMessage(canvas, message, x, y) {
                context.font = '7pt Small Fonts';
                context.fillStyle = 'white';
                context.fillText(message, x, y);
            }
            function getMousePos(canvas, evt) {
                var rect = canvas.getBoundingClientRect();
                return {
                    x: evt.clientX - rect.left,
                    y: evt.clientY - rect.top
                };
            }

            // ----- Events -----
            canvas.addEventListener('click', function(evt){
                var mousePos = getMousePos(canvas, evt);
                message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
                fighter.targetX = mousePos.x;
                fighter.targetY = mousePos.y;
            },false); 
        </script>
    </body>
</html>