---
title: "星际争霸AI日记_13"
layout: post
description: ""
robots: none
---

14:58

AI 的流程控制 FlowManager

所谓流程，应该是一个顺序递进的，庞大的状态机。每一个流程节点，都有一个结束标准。

一个流程结束，自动开启下一流程。

16:02 

就叫StateManager，简单明了。现在就三个模块了，Front，Back，State

StateManager不做实际操作，它只负责记录状态以及状态间的转换。

State的修改写成private，外面没有权限修改State，只有权限获得State. 这样可以保证外面很干净

然后，当StateManager的State发生变化，通过直接调用的方式告知其他的Manager

16:22

原来架构里面，比较好用的计划系统。但是需要修改成List方式的，或者队列状态的也对。

优先尝试使用std::queue，并且定义计划对象。当前的计划系统，被简单的定义为：Unit计划系统。
它负责在条件满足的时候，创建Unit。它可以被简单的定义为一个UnitType队列。可以封装一个函数，
当需要增加多个计划的时候，可以循环插入。

建造中的Unit，遍历Unit获得。在每一帧的开始，缓存必要的信息，尽可能的保证只有一次Unit遍历。
可以在屏幕上在每一帧的开始，遍历Unit然后输出到屏幕上。这个工作，交给BackManager进行。

20:20

UnitType里面的Beacon表示灯塔，没啥用，一般用作剧情模式的任务点。对抗里面看不见

20:30

Plan 系统看来需要抽象出来，做个结构体。因为还需要表示位置信息，尽管对于可移动的Unit，位置信息并不重要，
但是对于建筑物来说，位置信息非常关键，尤其对于开分矿来说。位置信息也可以缺省，这样Plan系统会随机位置构造建筑物。
但是这个抽象层貌似逃不掉了。

21:38

为了代码更简单，多循环几次全部Unit不重要。并且作为一个AI，将来肯定还有慢得多的代码在后面等着。所以PlanUpdate里面就直接循环了

21:55

如何判定当前正在建造的建筑物？因为告诉农民build了以后，这个时候金钱还是会被消耗，并且会有兵走过去。这个时候有可能造成本来决定建造了，但是到地方没有造出来。这个尴尬的问题如何处理？

最简单的方案是，在有农民去建造建筑物的时候，停止计划中的活动，等待建筑物建造完成。这样可以避免由于资源问题导致的建造失败。同时，如果因为其他单位占用了建造的位置，尝试换一个位置进行建造。这种方案需要解决一个问题，就是农民造建筑物发生障碍的回调是什么

22:33

现在还没解决建筑物建造被打断的问题。这个事儿以后再研究。